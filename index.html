<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Bubble Sort AR</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

    <!-- AR.js -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/three.js/build/ar.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <a-scene embedded arjs="sourceType: webcam;">
      <!-- Hiro marker -->
      <a-marker preset="hiro" id="marker">

        <!-- Bars group -->
        <a-entity id="bars" position="0 0 0" scale="0.4 0.4 0.4">

          <a-box id="b0" position="-2 0 0" depth="0.5" width="0.5" height="1" color="#4CC3D9"></a-box>
          <a-box id="b1" position="-1 0 0" depth="0.5" width="0.5" height="2" color="#4CC3D9"></a-box>
          <a-box id="b2" position="0 0 0" depth="0.5" width="0.5" height="0.8" color="#4CC3D9"></a-box>
          <a-box id="b3" position="1 0 0" depth="0.5" width="0.5" height="1.5" color="#4CC3D9"></a-box>
          <a-box id="b4" position="2 0 0" depth="0.5" width="0.5" height="1.2" color="#4CC3D9"></a-box>

        </a-entity>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const bars = [
        document.querySelector('#b0'),
        document.querySelector('#b1'),
        document.querySelector('#b2'),
        document.querySelector('#b3'),
        document.querySelector('#b4')
      ];

      let arr = [1, 2, 0.8, 1.5, 1.2];

      async function bubbleSort() {
        for (let i = 0; i < arr.length - 1; i++) {
          for (let j = 0; j < arr.length - i - 1; j++) {
            bars[j].setAttribute("color", "#FF4444");
            bars[j + 1].setAttribute("color", "#FF4444");

            await wait(700);

            if (arr[j] > arr[j + 1]) {
              await swapBars(j, j + 1);
            }

            bars[j].setAttribute("color", "#4CC3D9");
            bars[j + 1].setAttribute("color", "#4CC3D9");
          }
        }
      }

      function wait(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function swapBars(i, j) {
        let barA = bars[i];
        let barB = bars[j];

        let posA = barA.getAttribute("position");
        let posB = barB.getAttribute("position");

        barA.setAttribute("position", posB);
        barB.setAttribute("position", posA);

        let temp = arr[i];
        arr[i] = arr[j];
        arr[j] = temp;

        bars[i] = barB;
        bars[j] = barA;

        await wait(500);
      }

      document.querySelector("#marker").addEventListener("markerFound", () => {
        bubbleSort();
      });
    </script>
  </body>
</html>
